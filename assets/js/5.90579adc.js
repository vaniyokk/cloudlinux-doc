(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{193:function(t,e,s){"use strict";s.r(e);var a=s(0),i=Object(a.a)({},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content"},[t._m(0),t._v(" "),s("p",[t._v("Apache mod_lsapi is a module based on LiteSpeed Technologies API for PHP. It offers excellent PHP performance, low memory footprint coupled with great security and support for opcode caching.")]),t._v(" "),s("p",[t._v("mod_lsapi is a part of Apache;\nApache passes handling for PHP request to mod_lsapi;\nmod_lsapi uses liblsapi to transfers request lsphp daemon;\nlsphp processes request and return data to mod_lsapi;\neach user has lsphp processes in separate CageFS/LVE;\nIf there is no requests for lsapi_backend_pgrp_max_idle seconds, lsphp process is terminated;\nIf no lsphp processes available when new request comes, new lsphp process is created;\nlsphp can process lsapi_backend_children requests simultaneously.")]),t._v(" "),t._m(1),t._v(" "),s("p",[t._v("lsphp - PHP + LSAPI. What is LSAPI? LiteSpeed Server Application Programming Interface (LSAPI) is designed specifically for seamless, optimized communication between LiteSpeed Web Server and third party web applications. Now this protocol is available for Apache 2.2/2.4.")]),t._v(" "),s("p",[t._v("Using LSAPI, we have seen higher performance than Apache with mod_php, easier installation than php-fpm and easier integration with any control panel. LSAPI means faster and more stable dynamic web pages.")]),t._v(" "),s("p",[t._v("CageFS (installed and initialized) - optional, mod_lsapi can work without CageFS\nAlt-PHP (optional for EasyApache 4 and for DirectAdmin)\nea-php (for EasyApache 4 only)\nApache with SuExecuUserGroup directive for each user's VirtualHost\nmod_ruid2 disabled\napache itk disabled")]),t._v(" "),t._m(2),t._v(" "),t._m(3),s("p",[t._v("When installed, liblsapi will automatically create secret file used by mod_lsapi to communicate with backend:")]),t._v(" "),s("p",[t._v("owner root:root\nperms: 400")]),t._v(" "),s("p",[t._v("for making security pass PHPRC and UID|GID on start lsphp")]),t._v(" "),s("p",[t._v("Algorithm of creating:")]),t._v(" "),s("p",[t._v("/bin/dd if=/dev/random of=/etc/sysconfig/modlsapi.secret bs=16 count=1")]),t._v(" "),s("p",[t._v("Use the following syntax to manage MODLSAPI install utility:")]),t._v(" "),t._m(4),s("p",[t._v("Options:")]),t._v(" "),t._m(5),t._v(" "),s("p",[t._v("This tool:")]),t._v(" "),t._m(6),t._v(" "),s("p",[t._v("What commands are available for different control panels:")]),t._v(" "),t._m(7),t._v(" "),s("p",[t._v("mod_lsapi allows to use different handlers for different php versions. For example, a file with extension .php53 can be handled by php5.3 and a file with extension .php55 handled by php5.5 without PHP Selector.\nHere is an extra config file which allows to set handlers and php binaries for these handlers - _ /etc/container/php.handler_ . Example of this file:")]),t._v(" "),t._m(8),s("p",[t._v("Default handler for lsphp is - _ application/x-httpd-lsphp_ , if I set in .htaccess such options:")]),t._v(" "),t._m(9),s("p",[t._v("File index.php53 will be processed by php 5.3, but index.php processed by php standard, placed at /usr/local/bin/lsphp.")]),t._v(" "),t._m(10),t._v(" "),t._m(11),t._v(" "),s("p",[t._v("For example:")]),t._v(" "),t._m(12),t._v(" "),s("p",[t._v("But if the server has custom php in another location (for example _ /usr/local/php55/bin/lsphp_ ), then just make symlink to lsphp:")]),t._v(" "),t._m(13),t._v(" "),s("p",[t._v("and add it to php.handler:")]),t._v(" "),t._m(14),t._v(" "),s("p",[t._v("mod_lsapi is a drop in replacement for suPHP. No configuration changes required. To switch from suPHP to mod_lsapi:")]),t._v(" "),t._m(15),s("p",[t._v("Switch individual domains:")]),t._v(" "),t._m(16),t._m(17),t._v(" "),s("p",[t._v("For all control panels - SuExecUserGroup should be present for each virtual host.\nCageFS and will be installed by dependencies (for lsphp binaries).")]),t._v(" "),t._m(18),s("p",[t._v("If CageFS is not initialized:")]),t._v(" "),t._m(19),t._m(20),s("p",[t._v("How to convert EasyApache 4 for CloudLinux:")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.cloudlinux.com/blog/entry/beta-easyapache-4-released-for-cloudlinux",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.cloudlinux.com/blog/entry/beta-easyapache-4-released-for-cloudlinux"),s("OutboundLink")],1)]),t._v(" "),t._m(21),s("p",[t._v("Alternatively you can install mod_lsapi through EasyApache 4 web interface, just set of ea-apache24-mod_lsapi in the list of available modules.")]),t._v(" "),s("p",[t._v("If CageFS is not initialized:")]),t._v(" "),t._m(22),s("p",[t._v("After updating ea-apache24-mod_lsapi all the domains are switched to the default handler and to turn on mod_lsapi back, it was necessary to enable lsapi handler through .")]),t._v(" "),s("p",[t._v("We noticed that it is not very convenient to enable lsapi handler through after update and automated this process.")]),t._v(" "),s("p",[t._v("So, if you update ea-apache24-mod_lsapi from stable or ea-apache24-mod_lsapi-1.1-9 or lower from beta, after the update you need to run to add lsapi handler to .")]),t._v(" "),s("p",[t._v("After this, you will be asked to enable lsapi handler for proper PHP versions, depending on how you used mod_lsapi before ( , and then restart Apache.")]),t._v(" "),s("p",[t._v("Please note that the following options were disabled for ea-apache24-mod_lsapi:")]),t._v(" "),s("p",[t._v("You can manage your domains with PHP version and lsapi handler from .")]),t._v(" "),t._m(23),t._v(" "),t._m(24),t._v(" "),t._m(25),t._v(" "),t._m(26),t._m(27),t._v(" "),t._m(28),t._m(29),t._v(" "),t._m(30),t._v(" "),t._m(31),t._v(" "),t._m(32),t._m(33),t._v(" "),t._m(34),t._m(35),t._m(36),t._m(37),t._m(38),s("p",[t._v("Disable php.conf or any other PHP handler and uncomment in and restart Apache.")]),t._v(" "),t._m(39),s("p",[t._v("Follow these steps to install lsphp binaries needed for mod_lsapi:")]),t._v(" "),t._m(40),s("p",[t._v("If lsphp already exists, copy it to (this step allows you to avoid installing alt-php).")]),t._v(" "),s("p",[t._v("Compile mod_lsapi:")]),t._v(" "),t._m(41),s("p",[t._v("This will:\n-- Install: (or to another correct httpd modules path)\n-- Install:")]),t._v(" "),t._m(42),s("p",[t._v("If you want lsapi as global PHP handler, uncomment and disable current PHP handler. If server uses suPHP, you can enable lsphp for single hosts. Just add to site's .htaccess.")]),t._v(" "),t._m(43),t._m(44),t._v(" "),t._m(45),s("p",[t._v("Native PHP - PHP installed and used before alt-php packages were installed. Usualy lsphp binary is not available on the servers without LiteSpeed, which means that it should be created (build from php sources with such options as usual php binary file but with LSAPI protocol built-in).")]),t._v(" "),s("p",[t._v("There are two ways to make native lsphp:")]),t._v(" "),t._m(46),t._v(" "),s("p",[t._v("Native lsphp is made from alt-php56:")]),t._v(" "),t._m(47),t._m(48),t._m(49),t._m(50),t._v(" "),t._m(51),t._m(52),t._m(53),t._m(54),t._v(" "),s("p",[t._v("mod_lsapi errors will be located in error_log and sulsphp_log.\nNote that errors can appear in both logs at the same time, and you might need to refer to both of them to solve the issue.")]),t._v(" "),s("p",[t._v("See next table for more details:")]),t._v(" "),s("table",[t._m(55),t._v(" "),s("tbody",[t._m(56),t._v(" "),t._m(57),t._v(" "),t._m(58),t._v(" "),s("tr",[s("td"),t._v(" "),s("td"),t._v(" "),s("td",[t._v("lsphp has crashed. Next slide will explain what to do (core dump creating). Also, check configuration options for apc and suhosin in php.ini. Once you have a core file generated at DocumentRoot contact "),s("a",{attrs:{href:"https://helpdesk.cloudlinux.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://helpdesk.cloudlinux.com/"),s("OutboundLink")],1),t._v(" so we can investigate the cause.")])]),t._v(" "),t._m(59),t._v(" "),t._m(60),t._v(" "),t._m(61),t._v(" "),t._m(62),t._v(" "),t._m(63),t._v(" "),t._m(64),t._v(" "),t._m(65),t._v(" "),t._m(66),t._v(" "),t._m(67),t._v(" "),t._m(68),t._v(" "),t._m(69)])]),t._v(" "),s("p",[t._v("If apache runs under a username other than or , you should rebuild sulsphp (where username is built in for security reasons) with corresponding username:")]),t._v(" "),t._m(70),s("p",[t._v("This will:\n-- Install: so (or to another correct httpd modules path)\n-- Install:")]),t._v(" "),s("p",[t._v("Check if SuExecUserGroup specified for virtual hosts. This parameter is used by mod_lsapi for user identification.")]),t._v(" "),s("p",[t._v("Switch in lsapi.conf or value to:")]),t._v(" "),s("p",[t._v("Check if empty: , then run:")]),t._v(" "),t._m(71),s("p",[t._v("Then restart cron service.")]),t._v(" "),s("p",[t._v("If you need to run PHP using mod_lsapi using users with UID < 99, you would need to re-compile sulsphp:")]),t._v(" "),t._m(72),s("p",[t._v("will be installed\n-- Installing: (or another httpd modules path)\n-- Installing:")]),t._v(" "),t._m(73),s("p",[t._v("Will be installed:\n-- Installing: (or another httpd modules path)\n-- Installing:")]),t._v(" "),t._m(74),t._v(" "),t._m(75),t._v(" "),s("p",[t._v("This is safe solution for easyapache rebuilding and cpanel-mod-lsapi updating.")]),t._v(" "),s("p",[t._v("Make php.ini for suhosin as recommended below:")]),t._v(" "),s("p",[t._v("[suhosin]\nsuhosin.simulation = Off\nsuhosin.mail.protect = 1\nsuhosin.cookie.disallow_nul = Off\nsuhosin.cookie.max_array_depth = 1000\nsuhosin.cookie.max_array_index_length = 500\nsuhosin.cookie.max_name_length = 500\nsuhosin.cookie.max_totalname_length = 500\nsuhosin.cookie.max_value_length = 200000\nsuhosin.cookie.max_vars = 16384\nsuhosin.get.disallow_nul = Off\nsuhosin.get.max_array_depth = 1000\nsuhosin.get.max_array_index_length = 500\nsuhosin.get.max_name_length = 500\nsuhosin.get.max_totalname_length = 500\nsuhosin.get.max_value_length = 1000000\nsuhosin.get.max_vars = 16384\nsuhosin.post.disallow_nul = Off\nsuhosin.post.max_array_depth = 1000\nsuhosin.post.max_array_index_length = 500\nsuhosin.post.max_name_length = 500\nsuhosin.post.max_totalname_length = 500\nsuhosin.post.max_value_length = 1000000\nsuhosin.post.max_vars = 16384\nsuhosin.request.disallow_nul = Off\nsuhosin.request.max_array_depth = 1000\nsuhosin.request.max_array_index_length = 500\nsuhosin.request.max_totalname_length = 500\nsuhosin.request.max_value_length = 1000000\nsuhosin.request.max_vars = 16384\nsuhosin.request.max_varname_length = 524288\nsuhosin.upload.max_uploads = 300\nsuhosin.upload.disallow_elf = Off\nsuhosin.session.cryptua = Off\nsuhosin.session.encrypt = Off\nsuhosin.session.max_id_length = 1024\nsuhosin.executor.allow_symlink = Off\nsuhosin.executor.disable_eval = Off\nsuhosin.executor.disable_emodifier = Off\nsuhosin.executor.include.max_traversal = 8")]),t._v(" "),s("p",[t._v("Make php.ini for APC as recommended below:")]),t._v(" "),t._m(76),s("p",[t._v("shared memory should be not less than 32MB")]),t._v(" "),s("p",[t._v("This means that lsphp was crashed. Solution:")]),t._v(" "),s("p",[t._v("Check if apc for user enabled. Tune its options as described in previous slide.\nCheck if suhosin is enabled for user. Tune its options as described in this article.\nIf previous items do not help, contact us at "),s("a",{attrs:{href:"https://helpdesk.cloudlinux.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://helpdesk.cloudlinux.com/"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("Configure mod_lsapi to allow lsphp to generate core dumps. In mod_lsapi.conf:")]),t._v(" "),t._m(77),s("p",[t._v("Enable core file generation in sysctl:")]),t._v(" "),t._m(78),s("p",[t._v("Configure system to change max size of core files. In add:")]),t._v(" "),t._m(79),s("p",[t._v("where is the username for which lsphp crashes.")]),t._v(" "),s("p",[t._v("If exists, look up for the following lines:")]),t._v(" "),t._m(80),s("p",[t._v("Substring must be replaced with .")]),t._v(" "),t._m(81),t._v(" "),s("p",[t._v("Do cold restart of Apache with the command like this:")]),t._v(" "),t._m(82),s("p",[t._v("You can make sure that ulimit for lsphp is changed to unlimited successfully with the following command:")]),t._v(" "),t._m(83),s("p",[t._v("where PID is a pid of any lsphp process.")]),t._v(" "),t._m(84),t._v(" "),t._m(85),t._v(" "),t._m(86),t._v(" "),t._m(87),s("p",[t._v("is not empty.")]),t._v(" "),s("p",[t._v("If it is empty:")]),t._v(" "),t._m(88),t._v(" "),t._m(89),t._m(90),t._v(" "),t._m(91),t._m(92),t._v(" "),t._m(93),t._m(94),t._v(" "),t._m(95),t._v(" "),s("p",[t._v("A: Yes, it is. EasyApache works/fully integrates with mod_lsapi.")]),t._v(" "),t._m(96),t._v(" "),s("p",[t._v("A: Yes.")]),t._v(" "),t._m(97),t._v(" "),s("p",[t._v("A: Yes. mod_lsapi can read php_* and php_admin_* directives.")]),t._v(" "),t._m(98),t._v(" "),s("p",[t._v("A: No need to change httpd.conf. mod_lsapi can read suPHP_UserGroup, RUidGid, SuExecUserGroup, AssignUserID parameters to determine user id under which site is running. Additionally you can use lsapi_uid_gid or lsapi_user_group as a native way to specify user / group ids.")]),t._v(" "),t._m(99),t._v(" "),s("p",[t._v("A: When  lsapi_with_connection_pool mode is , then the new backend lsphp process has to be created for each new incoming request. At least it requires mod_lsapi to connect to backend lsphp master-process and have it perform fork which leads to a slowdown.")]),t._v(" "),s("p",[t._v("With")]),t._v(" "),s("p",[t._v("Alternatively, we have another accelerating technology - "),s("router-link",{attrs:{to:"/criu_support/"}},[t._v("CRIU")]),t._v(" , which is faster and uses less memory. But it is in Beta so far and available for CL7 only (stable version will appear in the near future).")],1),t._v(" "),t._m(100),t._v(" "),s("p",[t._v("A: There are several ways to do that.")]),t._v(" "),t._m(101),t._v(" "),s("p",[t._v("To find in user’s panel choose _ _ icon _ _ as follows:")]),t._v(" "),t._m(102),t._v(" "),s("p",[t._v("From you can manage PHP version and choose the necessary extensions to be used by PHP. Choose proper PHP version from the drop-down and click . Mark proper checkboxes to choose extensions and click :")]),t._v(" "),t._m(103),t._v(" "),s("p",[t._v("This is a simple and convenient way to configure the user's PHP.")]),t._v(" "),t._m(104),t._v(" "),s("p",[t._v("mod_lsapi installs alt-php56 as native by default (just copy of alt-php56):")]),t._v(" "),t._m(105),t._v(" "),s("p",[t._v("The native version is not designed to enable or disable PHP extensions through the web interface of the . This can lead to missing of the proper PHP extensions for customers applications.")]),t._v(" "),s("p",[t._v("For example, you can get the following reply from the website that is using and native PHP:")]),t._v(" "),t._m(106),t._v(" "),s("p",[t._v("There are two ways to solve this problem:")]),t._v(" "),s("p",[t._v("Use non-native PHP with proper extensions enabled via the (described above).\nUse native PHP with properly configured .ini files (described below).")]),t._v(" "),s("p",[t._v("To configure native PHP, use an additional .ini file :")]),t._v(" "),t._m(107),t._v(" "),s("p",[t._v("By default it is empty. To solve the issue this way, the following strings must be added:")]),t._v(" "),t._m(108),s("p",[t._v("All available extensions for alt-php56 can be seen by running the command:")]),t._v(" "),t._m(109),t._m(110),t._v(" "),t._m(111),t._v(" "),s("p",[t._v("You can find additional notes on native PHP installation (EasyApache 3 only) on the link: "),s("a",{attrs:{href:"https://docs.cloudlinux.com/mod_lsapi_installation.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://docs.cloudlinux.com/mod_lsapi_installation.html"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("To see what kind of native PHP is used, use the command:")]),t._v(" "),t._m(112),s("p",[t._v("Output example:")]),t._v(" "),t._m(113),s("p",[t._v("The command builds the lsphp of the same version, it will be used as native via the PHP Selector, but with another .ini file to configure.")]),t._v(" "),t._m(114),t._v(" "),s("p",[t._v("We do not recommend to use this native PHP because it does not support "),s("router-link",{attrs:{to:"/criu_support/"}},[t._v("CRIU")]),t._v(" .")],1),t._v(" "),s("p",[t._v("To revert alt-php56 to the native PHP, execute the following command:")]),t._v(" "),t._m(115),t._m(116),t._v(" "),s("p",[t._v("Installation process is done with :")]),t._v(" "),t._m(117),s("p",[t._v("When completed - run a command to setup mod_lsapi and register LSPHP handlers in Plesk Panel:")]),t._v(" "),s("p",[t._v("/usr/bin/switch_mod_lsapi --setup")]),t._v(" "),s("p",[t._v("The command adds handlers to Plesk Panel so they become available for domains.")]),t._v(" "),s("p",[t._v("Managing PHP handlers is fully done with according to their documentation: "),s("a",{attrs:{href:"http://download1.parallels.com/Plesk/PP12/12.0/Doc/en-US/online/plesk-administrator-guide/70669.htm",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://download1.parallels.com/Plesk/PP12/12.0/Doc/en-US/online/plesk-administrator-guide/70669.htm"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("Quick reference:")]),t._v(" "),s("p",[t._v("Enabling lsapi for single domain is done with , select desired LSPHP handler for domain.")]),t._v(" "),s("p",[t._v("Enabling lsapi for multiple domains is done with , select desired LSPHP handler to be used by all users under a plan. If a subscription is not locked (user changed nothing in it), after clicking domains will start using lsapi.")]),t._v(" "),t._m(118),t._v(" "),s("p",[t._v("There is no way to switch all plans to lsapi - it should be done one-by-one .")]),t._v(" "),t._m(119),t._v(" "),s("p",[t._v("From the dialog box, select PHP version.")]),t._v(" "),t._m(120),t._v(" "),s("p",[t._v("Click _ _ and to confirm.")]),t._v(" "),t._m(121),t._v(" "),s("p",[t._v("Chose .")]),t._v(" "),s("p",[t._v("From the dialog box select proper PHP version and PHP modules (or defaults).")]),t._v(" "),t._m(122),t._v(" "),s("p",[t._v("From now on, on your domain will be applied PHP with version and modules which are set by handled by mod_lsapi.")]),t._v(" "),t._m(123),t._v(" "),t._m(124),t._v(" "),t._m(125),t._v(" "),s("p",[t._v("CRIU is , (pronounced ), is a software tool for Linux operating system. Using this tool, you can freeze a running application (or part of it) and checkpoint it as a collection of files on disk. You can then use the files to restore the application and run it exactly as it was during the time of freeze (more information on the link "),s("a",{attrs:{href:"https://criu.org/Main_Page",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://criu.org/Main_Page"),s("OutboundLink")],1),t._v(" ).")]),t._v(" "),s("p",[t._v("mod_lsapi-1.1-1 is the first beta version with freezing PHP implemented. mod_lsapi now supports the following parameters:")]),t._v(" "),t._m(126),t._v(" "),s("p",[t._v("Example:")]),t._v(" "),t._m(127),t._v(" "),s("p",[t._v("When Apache module mod_lsapi detects CRIU enabled (lsapi_criu On) it prepares a directory for images (on the first request of virtualhost) to store ( ), and starts lsphp process. Lsphp increases counter ( ) via shared memory or signals, when counter reaches limit ( ), lsphp sends the request to CRIU for freezing. CRIU service makes images of requested processes. Lsphp will not be frozen if counter has not reached the limit. The next time when lsphp will be stopped, it will be unfrozen from the images.")]),t._v(" "),s("p",[t._v("The images of the processes will be saved even if Apache is restarted. But all images will be deleted after server restart by default configuration. This can be modified by setting the new path .")]),t._v(" "),t._m(128),t._v(" "),s("p",[t._v("**Note ** that CRIU (version lower than criu-lve-3.6-1) can't correctly freeze with enabled. For correct work, must be in . For disabling:")]),t._v(" "),s("p",[t._v("Copy to and change there")]),t._v(" "),t._m(129),s("p",[s("code"),t._v("\nOr it would be technically better to provide a small override of service file rather than copying the whole new version in … ( "),s("a",{attrs:{href:"http://www.freedesktop.org/software/systemd/man/systemd.unit.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("www.freedesktop.org/software/systemd/man/systemd.unit.html)"),s("OutboundLink")],1),t._v(") .")]),t._v(" "),t._m(130),s("p",[t._v("and")]),t._v(" "),t._m(131),s("p",[t._v("Criu is installed with dependency to mod_lsapi-1.1 package. To activate it:")]),t._v(" "),t._m(132),t._v(" "),t._m(133),t._m(134),t._v(" "),t._m(135),t._m(136),t._v(" "),t._m(137),t._m(138),t._v(" "),t._m(139),t._v(" "),s("p",[t._v("On the next restart of Apache all of the images will be cleaned.")]),t._v(" "),t._m(140),t._v(" "),s("p",[t._v("Note that this option works only if is (default value is , it is set in _ lsapi.conf_ too).")]),t._v(" "),t._m(141),t._v(" "),s("p",[t._v("Current mod_lsapi allows cleaning all images only with one flag file.")]),t._v(" "),s("p",[t._v("Create _ _ file. Also don't forget to set such permissions (or for non cPanel) and access mode [700] to the _ _ directory.")]),t._v(" "),s("p",[t._v("Steps to do :")]),t._v(" "),t._m(142),s("p",[t._v("On the next requests to all virtual hosts images will be recreated (deleted first and created again later - it depends on lsapi_backend_initial_start value).")]),t._v(" "),t._m(143),t._v(" "),s("p",[t._v("If a user needs to clean CRIU images for lsphp, he should create a file: _ _ . Where _ _ is a ServerName from the VirtualHost block in the configuration file. On the next restart of lsphp, the images will be cleaned.")]),t._v(" "),t._m(144),t._v(" "),t._m(145),t._m(146),t._v(" "),t._m(147),t._v(" "),s("p",[t._v("This mode is enabled by default and creates a separate lsphp process for each virtual host.")]),t._v(" "),s("p",[t._v("flag will not work for a user when lsapi_per_user option is .")]),t._v(" "),t._m(148)])},[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"apache-mod-lsapi"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#apache-mod-lsapi","aria-hidden":"true"}},[this._v("#")]),this._v(" Apache mod_lsapi")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:"/images/mod_lsapidiagrammnew.jpg",alt:""}})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("table",[s("thead",[s("tr",[s("th"),t._v(" "),s("th"),t._v(" "),s("th")])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("strong",[t._v("Options")])]),t._v(" "),s("td",[s("strong",[t._v("Description")])]),t._v(" "),s("td",[s("strong",[t._v("Level")])])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("mod_php emulation")]),t._v(" "),s("td",[t._v("httpd.conf, virtualhost, htaccess")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("Switching mod_lsapi handler on or off")]),t._v(" "),s("td",[t._v("httpd.conf")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("number of usec to wait while lsPHP starts (if not started on request)")]),t._v(" "),s("td",[t._v("httpd.conf")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("number of retries to connects to lsPHP daemon")]),t._v(" "),s("td",[t._v("httpd.conf")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("httpd.conf, On - stop lsphp services on apache restart, Off - leave live started lsphp services on apache restart (for php+opcache). The lsphp will not restart, even if Apache gets restarted.")]),t._v(" "),s("td",[t._v("httpd.conf")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("sets env variable LSAPI_CHILDREN # Maximum number of simultaneously running child backend processes. # Optional, a default value is equal to EP. # min value is 2; max value is 10000. If var value is more, 10000 will be used.")]),t._v(" "),s("td",[t._v("httpd.conf")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("sets env variable LSAPI_MAX_PROCESS_TIME # Optional. Default value is 300. # Timeout to kill runaway processes")]),t._v(" "),s("td",[t._v("httpd.conf")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("sets env variable LSAPI_PGRP_MAX_IDLE, in seconds. # Controls how long a control process will wait for a new request before it exits. # 0 stands for infinite. # Optional, default value is 30. # Should be more or equal to 0.")]),t._v(" "),s("td",[t._v("httpd.conf")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("enable debugging for mod_lsapi, acceptable values: on/off")]),t._v(" "),s("td",[t._v("httpd.conf")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("Path to back end lsphp sockets. By default /var/run/mod_lsapi")]),t._v(" "),s("td",[t._v("httpd.conf")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("Invoke master lsPHP process not per VirtualHost but per account")]),t._v(" "),s("td",[t._v("httpd.conf")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("Sets PHPRC env variaable")]),t._v(" "),s("td",[t._v("httpd.conf, virtualhost")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("Set user & group for requests")]),t._v(" "),s("td",[t._v("httpd.conf, virtualhost, directory")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("Set user id & group id for requests")]),t._v(" "),s("td",[t._v("httpd.conf, virtualhost, directory")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("Use default apache UID/GID if no uid/gid set. Values: On/Off. If Off, and no UID/GID set, error 503 will be returned. Default - Off")]),t._v(" "),s("td",[t._v("httpd.conf")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("check target PHP script permissions. If set to On, lsapi will check that script is owned by the same user, as user under which it is being executed. Return 503 error if they don't match. Default: Off")]),t._v(" "),s("td",[t._v("httpd.conf")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("Time to wait for response from the lsphp daemon, in seconds. 0 stands for infinity. For preventing long running processes which can use EP (limit number of entry processes). Default value is 300.")]),t._v(" "),s("td",[t._v("httpd.conf")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("env variable LSAPI_ALLOW_CORE_DUMP (On or Off). Pass LSAPI_ALLOW_CORE_DUMP to lsphp or not. If it will be passed - core dump on lsphp crash will be created. # Off by default # By default a LSAPI application will not leave a core dump file when crashed. If you want to have # LSAPI PHP dump a core file, you should set this environment variable. If set, regardless the # value has been set to, core files will be created under the directory that the PHP script in. LSAPI_ALLOW_CORE_DUMP")]),t._v(" "),s("td",[t._v("httpd.conf")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("On/Off - disable php_* directives, default On.")]),t._v(" "),s("td",[t._v("httpd.conf, virtualhost, htaccess")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("On/Off - disable enable connect pool, default Off")]),t._v(" "),s("td",[t._v("httpd.conf")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("It is relevant only with lsapi_with_connection_pool option switched on. Controls how long a worker process will wait for a new request before it exits.")]),t._v(" "),s("td",[t._v("httpd.conf")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("It is relevant only with lsapi_with_connection_pool option switched on. Controls how many requests a worker process will process before it exits.")]),t._v(" "),s("td",[t._v("httpd.conf")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v('Pass env variable to lsphp. By default lsphp environment have only TEMP, TMP and PATH variables set. Example: lsapi_set_env TMP "/var/lsphp-tmp" Note: PATH env var default "/usr/local/bin:/usr/bin:/bin" cannot be changed because of security reasons. To change it, use explicitly lsapi_set_env_path option')]),t._v(" "),s("td",[t._v("httpd.conf")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("Change PATH variable in the environment of lsPHP processes.")]),t._v(" "),s("td",[t._v("httpd.conf")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("Check or not permissions of target php scripts")]),t._v(" "),s("td",[t._v("httpd.conf")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("Check or not the owner of DOCUMENT ROOT")]),t._v(" "),s("td",[t._v("httpd.conf")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("Enable .user.ini files for backend. Same as suphp, php-fpm and fcgid mechanism of .user.ini. Default value is Off")]),t._v(" "),s("td",[t._v("httpd.conf, virtualhost")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("On/Off. If lsapi_enable_user_ini option is set to On, then enable/disable processing .user.ini file in home directory also. Default value is Off")]),t._v(" "),s("td",[t._v("httpd.conf, virtualhost")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("Enable/disable CRIU for lsphp freezing. Can be: On/Off. Default: Off")]),t._v(" "),s("td",[t._v("httpd.conf")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("Set path to socket for communication with criu service [should be path] - default: /var/run/criu/criu_service.socket")]),t._v(" "),s("td",[t._v("httpd.conf")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("Enable/disable flag for notification about lsphp started. This method avoid cycles of waiting for lsphp start/ Can be: On/Off. Default: On")]),t._v(" "),s("td",[t._v("httpd.conf")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("Number of request when lsphp should be freezed. Should be [number] - default 0")]),t._v(" "),s("td",[t._v("httpd.conf")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("Method of requests counting. Off - use shared memory. Signals - use signals from child processes to parent. Default: Off")]),t._v(" "),s("td",[t._v("httpd.conf")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("Path to folder where imgs of freezed PHP will be stored. Should be path. Default: /var/run/mod_lsapi/")]),t._v(" "),s("td",[t._v("httpd.conf")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("Disabling HTTP responses buffering on Apache level. On - enable buffering. Off - disable buffering")]),t._v(" "),s("td",[t._v("httpd.conf, virtualhost, htaccess")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("can be used only when lsapi_backend_use_own_log is On. On - backend processes of the all virtual hosts will share the common log file. Off - every virtual host will have its own backend log file.")]),t._v(" "),s("td",[t._v("httpd.conf, virtualhost")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("Redirecting log output of backend processes from Apache error_log to dedicated log file or files, depending on value of lsapi_backend_common_own_log option.")]),t._v(" "),s("td",[t._v("httpd.conf, virtualhost")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("Enable or disable phpini_* directive processing. Default value is Off")]),t._v(" "),s("td",[t._v("httpd.conf, virtualhost, directory")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("When lsapi_process_phpini option switched to Off, these values will be silently ignored. lsapi_phpini values with absolute filename of php.ini file can be inserted into .htaccess files in order to set custom php.ini which will override/complement settings from system default php.ini.")]),t._v(" "),s("td",[t._v("httpd.conf, virtualhost, directory")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("Acceptable values: on/off: If a new HTTP request is coming to LSPHP daemon when all LSPHP workers are still busy, it can process this situation in two different ways. In REJECT mode LSPHP daemon will reject such request immediately. Otherwise, in legacy mode LSPHP daemon will put this request into infinite queue, until one or more LSPHP daemon becomes free. When HTTP request is rejected in REJECT mode, mod_lsapi will write into Apache error_log the following message: Connect to backend rejected, and client will receive 507 HTTP response.  By default LSPHP daemon in CloudLinux uses REJECT mode. It can be switched off with this option.")]),t._v(" "),s("td",[t._v("httpd.conf, virtualhost")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("Enable or disable a mechanism to avoid creation of zombie processes by lsphp. Default value is Off.")]),t._v(" "),s("td",[t._v("httpd.conf, virtualhost")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("To disable addition of PWD variable. Default value is Off. If set to On, the PWD variable will not be added into a backend environment.")]),t._v(" "),s("td",[t._v("httpd.conf, virtualhost")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("LoadModule lsapi_module modules/mod_lsapi.so\n \n<IfModule lsapi_module>\n         AddType application/x-httpd-lsphp .php\nlsapi_backend_connect_timeout 100000\n          lsapi_backend_connect_tries 10\n          lsapi_backend_children 20\n          lsapi_backend_pgrp_max_idle 30\n          lsapi_backend_max_process_time 300\n          lsapi_debug Off\n</IfModule>\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("/usr/bin/switch_mod_lsapi [OPTIONS]\n")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("table",[s("thead",[s("tr",[s("th"),t._v(" "),s("th")])]),t._v(" "),s("tbody",[s("tr",[s("td"),t._v(" "),s("td",[t._v("setup "),s("em",[t._v("mod_lsapi")]),t._v(" configurations for Apache")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("only EasyApache 4 feature")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("uninstall "),s("em",[t._v("mod_lsapi")]),t._v(" from Apache")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("enable _ mod_lsapi_ for individual domain")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("disable "),s("em",[t._v("mod_lsapi")]),t._v(" for individual domain")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("sets up "),s("em",[t._v("mod_lsapi")]),t._v(" as a default way to serve PHP, making it enabled for all domains. Once that mode is enabled, you cannot disable "),s("em",[t._v("mod_lsapi")]),t._v(" for individual domain")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("disable "),s("em",[t._v("mod_lsapi")]),t._v(" as a default way to serve PHP, disabling "),s("em",[t._v("mod_lsapi")]),t._v(" for all domains, including those selected earlier using "),s("em",[t._v("--enable-domain")])])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("build native lsphp for cPanel EA3")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("build native lsphp for cPanel EA3 (with custom PHP source path)")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("check PHP configuration")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("switch verbose level on")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("only with setup option (EA4)")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("return usage statistics in JSON format;  the following statistics metrics are collected: control panel name; mod_lsapi version; liblsapi version; criu version and status; whether mod_lsapi is enabled; lsapi configuration options; number of domains, that use "),s("em",[t._v("mod_lsapi")]),t._v(" , per each installed PHP version (only supported for cPanel EA4, Plesk, and DirectAdmin).")])])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("Creates native "),s("em",[t._v("lsphp")]),t._v(" (if it doesn't exist) by doing:\nRemoves config template for "),s("em",[t._v("mod_ruid2")]),t._v("\nConfigures Apache handler "),s("em",[t._v("application/x-httpd-lsphp")]),t._v("\nSwitches domain to "),s("em",[t._v("lsphp")]),t._v(" or enable global "),s("em",[t._v("lsphp")]),t._v("\nFor cPanel EA3 can build native lsphp")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("table",[s("thead",[s("tr",[s("th"),t._v(" "),s("th"),t._v(" "),s("th"),t._v(" "),s("th"),t._v(" "),s("th"),t._v(" "),s("th"),t._v(" "),s("th"),t._v(" "),s("th")])]),t._v(" "),s("tbody",[s("tr",[s("td"),t._v(" "),s("td",[t._v("No Control Panel")]),t._v(" "),s("td",[t._v("cPanel EA3")]),t._v(" "),s("td",[t._v("cPanel EA4")]),t._v(" "),s("td",[t._v("DirectAdmin")]),t._v(" "),s("td",[t._v("Plesk")]),t._v(" "),s("td",[t._v("InterWorx")]),t._v(" "),s("td",[t._v("ISPManager")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("+")]),t._v(" "),s("td",[t._v("+")]),t._v(" "),s("td",[t._v("+")]),t._v(" "),s("td",[t._v("+ (no need in manual calling)")]),t._v(" "),s("td",[t._v("+")]),t._v(" "),s("td",[t._v("+")]),t._v(" "),s("td",[t._v("+")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("+")]),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("-")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("+")]),t._v(" "),s("td",[t._v("+")]),t._v(" "),s("td",[t._v("+")]),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("+")]),t._v(" "),s("td",[t._v("+")]),t._v(" "),s("td",[t._v("+")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("+")]),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("-")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("+")]),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("-")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("+")]),t._v(" "),s("td",[t._v("+")]),t._v(" "),s("td",[t._v("+/-(custombuild)")]),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("-")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("+")]),t._v(" "),s("td",[t._v("+")]),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("-")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("+")]),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("+/-(custombuild)")]),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("-")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("+")]),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("-")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("+")]),t._v(" "),s("td",[t._v("+")]),t._v(" "),s("td",[t._v("+")]),t._v(" "),s("td",[t._v("+")]),t._v(" "),s("td",[t._v("+")]),t._v(" "),s("td",[t._v("+")]),t._v(" "),s("td",[t._v("+")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("+")]),t._v(" "),s("td",[t._v("+")]),t._v(" "),s("td",[t._v("+")]),t._v(" "),s("td",[t._v("+")]),t._v(" "),s("td",[t._v("+")]),t._v(" "),s("td",[t._v("+")]),t._v(" "),s("td",[t._v("+")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("+")]),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("-")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("+(without domain info)")]),t._v(" "),s("td",[t._v("+(without domain info)")]),t._v(" "),s("td",[t._v("+(with domain info)")]),t._v(" "),s("td",[t._v("+(with domain info)")]),t._v(" "),s("td",[t._v("+(with domain info)")]),t._v(" "),s("td",[t._v("+(without domain info)")]),t._v(" "),s("td",[t._v("+(without domain info)")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("# cat /etc/container/php.handler\napplication/x-lsphp53 /opt/alt/php53/usr/bin/lsphp\napplication/x-lsphp55 /opt/alt/php55/usr/bin/lsphp\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('<FilesMatch "\\.(php4|php5|php3|php2|php|phtml)$">\nSetHandler application/x-httpd-lsphp\n</FilesMatch>\n<FilesMatch "\\.php53$">\nSetHandler application/x-lsphp53</FilesMatch>\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("Important:")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("All custom PHP for "),s("em",[t._v("phpperdir")]),t._v(" mechanizm should be located in any place in the directory _ /opt/alt/, _ because before start "),s("em",[t._v("lsphp")]),t._v(" mod_lsapi checks as follows: "),s("em",[t._v("/usr/local/bin/lsphp")]),t._v(" or "),s("em",[t._v("/opt/alt/*/lsphp")]),t._v(" . Such location and binary file are allowed to execute. Use the folder "),s("em",[t._v("/opt/alt/[any path]")]),t._v(" for installing custom php.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("em",[this._v("/opt/alt/php.perdir/php55/bin/lsphp")]),this._v(" - it will work with mod_lsapi.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("ln "),e("em",[this._v("-sf /usr/local/php55/bin/lsphp /opt/alt/php.perdir/php55/bin/lsphp")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("em",[this._v("myhandler-php55 /opt/alt/php.perdir/php55/bin/lsphp")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("/usr/bin/switch_mod_lsapi --enable-global \n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("/usr/bin/switch_mod_lsapi --enable-domain test.example.tst - enablesmod_lsapi [only for domain test.example.tst]\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"installation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#installation","aria-hidden":"true"}},[this._v("#")]),this._v(" Installation")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ yum install liblsapi liblsapi-devel \n$ yum install mod_lsapi \n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ cagefsctl --init\n$ cagefsctl --enable-all\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ /usr/bin/switch_mod_lsapi --setup\n# Enable for a single domain:\n$ /usr/bin/switch_mod_lsapi --enable-domain [domain]\n# or globally\n$  /usr/bin/switch_mod_lsapi --enable-global\n$ service httpd restart\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ yum install liblsapi liblsapi-devel\n$ yum install ea-apache24-mod_lsapi \n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ cagefsctl --init\n$ cagefsctl --enable-all\n$ /usr/bin/switch_mod_lsapi --setup\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("em",[this._v("Please note that lsapi PHP handler is only available for beta version")]),this._v(" .")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("em",[this._v("Example 1:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",[e("li",[e("p",[this._v("ea-apache24-mod_lsapi-1.0-30 was installed and globally enabled.")])]),this._v(" "),e("li",[e("p",[this._v("The command was executed.")])]),this._v(" "),e("li",[e("p",[this._v("While is not called, mod_lsapi will work as before.")])]),this._v(" "),e("li",[e("p",[this._v("will return:")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("Instruction: \npatching file apache.pm\nPatch was applied correctly...\nAdded hook for System::upcp to hooks registry\nmod_lsapi switched to turning on and off through the MultiPHP                                                 Manager(/Home/Software/MultiPHP Manager)\nYou are using enabled globally mod_lsapi. Do you want to enable mod_lsapi through                 MultiPHP Manager?\nCurrent PHP will be switched to lsapi handler:\nea-php53 SAPI: suphp\nea-php54 SAPI: suphp\nea-php55 SAPI: cgi\nea-php56 SAPI: suphp\nea-php70 SAPI: cgi\nea-php71 SAPI: suphp\nIf you type no then mod_lsapi will be disabled and you can enable it again from                 MultiPHP Manager.\nDo you want to proceed? [y/N]\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"5"}},[e("li",[e("p",[this._v("If N is chosen, then mod_lsapi moves to the new type of integration with cPanel and restores files . Mod_lsapi will be disabled.")])]),this._v(" "),e("li",[e("p",[this._v("If Y is chosen, then all installed versions will move to lsapi handler.")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("Setting ea-php53 to lsapi handler...\nSetting ea-php54 to lsapi handler...\nSetting ea-php55 to lsapi handler...\nSetting ea-php56 to lsapi handler...\nSetting ea-php70 to lsapi handler...\nSetting ea-php71 to lsapi handler...\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:"/images/mod_lsapi_handler.jpg",alt:""}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("em",[this._v("Example 2:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",[e("li",[e("p",[this._v("ea-apache24-mod_lsapi-1.0-30 was installed and enabled only for one domain but all other domains have the same ea-php56 version.")])]),this._v(" "),e("li",[e("p",[this._v("The command was executed.")])]),this._v(" "),e("li",[e("p",[this._v("While is not called, mod_lsapi will work as before.")])]),this._v(" "),e("li",[e("p",[this._v("will return:")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("Instruction: \npatching file apache.pm\nPatch was applied correctly...\nAdded hook for System::upcp to hooks registry\nDomains that handled by ea-php56:\ntstdomain01.com - lsapi\ntstdomain02.com - suphp\nThere are domains which are using mod_lsapi through --enable-domain option.\nThis option is deprecated for EA4 and mod_lsapi switched to turning on and off through\nthe MultiPHP Manager(/Home/Software/MultiPHP Manager)\nDo you want to enable mod_lsapi through MultiPHP Manager for ea-php56?\nDomains which are using suphp will be switched to lsapi handler too.\nIf you type N then mod_lsapi will remain enabled on these domains.\nHowever, enabling mod_lsapi for new domains is now possible only through MultiPHP\nManager.\nDo you want to proceed? [y/N] y\nSetting ea-php56 to lsapi handler...\nBuilt /etc/apache2/conf/httpd.conf OK\nReconfiguration completed\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"5"}},[e("li",[e("p",[this._v("If N is chosen, then mod_lsapi will move to the new type of integration with cPanel and will restore files . Mod_lsapi still will be enabled for domains like in example file.")])]),this._v(" "),e("li",[e("p",[this._v("If Y is chosen, then displayed PHP version will move to lsapi handler. According to the example, using ea-php56, will be switched to lsapi handler.")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ cd /usr/local/directadmin/custombuild\n$ ./build update\n$ ./build set php1_mode lsphp\n$ ./build php n\n$ ./build apache\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ yum install liblsapi liblsapi-devel \n$ yum install mod_lsapi \n$ /usr/bin/switch_mod_lsapi --setup\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("<Directory /var/www/*/data/>\nphp_admin_flag engine off\n</Directory\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("<Directory /var/www/[username]/data/www/[domain]>\nOptions -ExecCGI -Includes\nphp_admin_flag engine on\n</Directory>\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ yum install liblsapi liblsapi-devel \n$ yum install mod_lsapi \n$ /usr/bin/switch_mod_lsapi --setup\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ service httpd restart\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ yum install cagefs lvemanager cmake gcc httpd-devel apr-devel\n$ yum groupinstall alt-php\n$ cagefsctl --init\n$ cagefsctl --enable-all\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ yum install liblsapi liblsapi-devel\n$ cd ~\n$ wget \n$ tar zxvf mod_lsapi.tar.gz\n$ cd mod_lsapi-0.2-7\n$ cmake .\n$ make\n$ make install\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ cp conf/mod_lsapi.conf /etc/httpd/conf/extra/ #(or another httpd conf directory)\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ install/da_cb_install\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("For last preparation of CageFS and PHP Selector should be created by script "),e("code",[this._v("n")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ service httpd restart\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",[e("li",[this._v("The quick one (supports all type of panels).")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("switch_mod_lsapi --setup\ncp /opt/alt/php56/usr/bin/lsphp /usr/local/bin/\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("switch_mod_lsapi --build-native-lsphp\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("/usr/local/directadmin/custombuild/build set php1_mode lsphp\n/usr/local/directadmin/custombuild/build php n\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"uninstall"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#uninstall","aria-hidden":"true"}},[this._v("#")]),this._v(" Uninstall")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ /usr/bin/switch_mod_lsapi --uninstall\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ cd /usr/local/directadmin/custombuild\n$ ./build update\n$ ./build set php1_release [any other php type]\n$ ./build php n\n$ ./build apache\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ yum erase mod_lsapi\n$ rm [path to mod_lsapi.conf]\n# restore standard php handler\n$ service httpd restart\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"troubleshooting"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#troubleshooting","aria-hidden":"true"}},[this._v("#")]),this._v(" Troubleshooting")])},function(){var t=this.$createElement,e=this._self._c||t;return e("thead",[e("tr",[e("th"),this._v(" "),e("th"),this._v(" "),e("th")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("tr",[e("td",[e("strong",[this._v("error_log")])]),this._v(" "),e("td",[e("strong",[this._v("sulsphp_log")])]),this._v(" "),e("td",[e("strong",[this._v("Solution")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("tr",[e("td"),this._v(" "),e("td"),this._v(" "),e("td",[this._v("Increase pmem or vmem limits for the user uid.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("tr",[e("td"),this._v(" "),e("td"),this._v(" "),e("td",[this._v("lsphp was killed. It can be due to apache restart or lfd. If you see this  message too often - change to in lsapi.conf or add to the following lines: pexe:/opt/alt/php.*/usr/bin/lsphp")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("tr",[e("td"),this._v(" "),e("td"),this._v(" "),e("td",[this._v("Incorrect lsphp file permissions. For fixing: cagefsctl --force-update.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("tr",[e("td"),this._v(" "),e("td"),this._v(" "),e("td",[this._v("UID/GID are not set in  virtualhost. Set in lsapi.conf (it is by default since 0.1-98 version, this solution is for older versions).")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("tr",[e("td"),this._v(" "),e("td"),this._v(" "),e("td",[this._v("File is not owned by the user PHP executed by. To overwrite (insecure), set in lsapi.conf.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("tr",[e("td"),this._v(" "),e("td"),this._v(" "),e("td",[this._v("Check if СageFS enabled. Try running")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("tr",[e("td"),this._v(" "),e("td"),this._v(" "),e("td",[this._v("Check if is not inside CageFS) exists and owner should be apache: apache for DirectAdmin, Plesk, iWorx, ISPManager and nobody for cPanel.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("tr",[e("td"),this._v(" "),e("td"),this._v(" "),e("td",[this._v("Increase PMEM limits for the user UID.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("tr",[e("td"),this._v(" "),e("td"),this._v(" "),e("td",[this._v("Increase value of for UID in vhost.conf or globally in lsapi.conf.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("tr",[e("td"),this._v(" "),e("td"),this._v(" "),e("td",[this._v("Increase NPROC limits for the UID. It should be greater than EP and")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("tr",[e("td"),this._v(" "),e("td"),this._v(" "),e("td",[this._v("These errors occurs when the amount of PMEM limits is incommensurable with the number of EP. Increase PMEM limits or decrease EP number for the user UID.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("tr",[e("td"),this._v(" "),e("td"),this._v(" "),e("td",[this._v("Increase LimitRequestBody (Apache) or/and SecRequestBodyNoFilesLimit (mod_security) configuration limits")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("tr",[e("td"),this._v(" "),e("td"),this._v(" "),e("td",[this._v("Check that "),e("code"),this._v(" disabled")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ yum install liblsapi liblsapi-devel \n$ cd ~\n$ wget \n$ tar zxvf mod_lsapi.tar.gz\n$ cd mod-lsapi-0.1-37\n$ cmake -DHTTPD_USER=<new user name> .\n$ make\n$ make install\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("yum install lve-utils\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ yum install liblsapi liblsapi-devel\n$ cd ~\n$ wget \n$ tar zxvf mod_lsapi.tar.gz\n$ cd mod-lsapi-0.1-XX\n$ cmake -DUID_MIN=80 -DGID_MIN=80 .\n$ make\n$ make install\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('$ yum install liblsapi liblsapi-devel \n$ cd ~\n$ wget http://repo.cloudlinux.com/cloudlinux/sources/da/mod_lsapi.tar.gz        \n$ tar zxvf mod_lsapi.tar.gz\n$ cd mod-lsapi-0.1-XX\n$ cmake -DPARENT_NAME="<apache binary name>".\n$ make\n$ make install\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("6. WHMCS Status page not accessible after installing CL and mod_lsapi (cPanel).")])])},function(){var t=this.$createElement;return(this._self._c||t)("p",[this._v("add userstat\nadd to file (to the end of file before\nlsapi_user_group userstat userstat\n"),this._v("\nservice httpd restart")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("[apc]\n...\napc.shm_segments=1\napc.shm_size=32\n...\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("lsapi_backend_coredump On\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("sysctl -w ‘kernel.core_uses_pid=1’\nsysctl -w ‘kernel.core_pattern=core.%p’\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("user1 soft core unlimited\nuser1 hard core unlimited\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('if [ "$LIMITUSER" != "root" ]; then\nulimit -n 100 -u 35 -m 200000 -d 200000 -s 8192 -c 200000 -v unlimited 2>/dev/null\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Add line "),e("code"),this._v(" into script just after another invokes of the command.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("service httpd stop; sleep 2; killall lsphp; service httpd start\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("cat /proc/PID/limits | grep ‘Max core file size’\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Core dump of lsphp will be created in the DocumentRoot of the corresponding virtual server.\nOn cPanel server it should map to "),e("code")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("mod_lsapi is not included in output of httpd -M after installation and setup command for cPanel EasyApache 3")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",[e("li",[e("p",[this._v("Check if the file exists and not empty;")])]),this._v(" "),e("li",[e("p",[this._v("Check if output of the command")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('cat /usr/local/apache/conf/httpd.conf | grep "/usr/local/apache/conf/conf.d/\\*\\.conf"\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",[e("li",[this._v("Add to section of string:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('"include": \'"/usr/local/apache/conf/conf.d/*.conf"\'\n "include":\n   "directive": \'include\'\n   "items":\n...\n     -\n     "include": \'"/usr/local/apache/conf/conf.d/*.conf"\'\n "listen":\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"2"}},[e("li",[this._v("Do:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("mkdir -p /usr/local/apache/conf/conf.d/;                                                                                 cp /usr/share/lve/modlscapi/confs/lsapi.conf /usr/local/apache/conf/conf.d/lsapi.conf\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"3"}},[e("li",[this._v("Call:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("/scripts/rebuildhttpdconf\n/scripts/restartsrv_httpd\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"faq-on-mod-lsapi"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#faq-on-mod-lsapi","aria-hidden":"true"}},[this._v("#")]),this._v(" FAQ on mod_lsapi")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Q: "),e("strong",[this._v("_ Is it compatible with EasyApache?_")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Q: "),e("strong",[this._v("_Is it compatible with _")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Q: "),e("strong",[this._v("_ Are .htaccess PHP directives supported? For example, mod_php like directives?_")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Q: "),e("strong",[this._v("_ I have httpd.conf with SuExecUserGroup options. Do I need to add mod_lsapi related options for VirtualHost?_")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Q: "),e("strong",[this._v("_What is the difference between running mod_lsapi with lsapi_with_connection_pool mode _")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Q: "),e("strong",[e("em",[this._v("Your PHP installation appears to be missing the… How to manage native PHP with mod_lsapi under EasyApache 3?")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",[e("li",[this._v("_Using _")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:"/images/mod_lsapi_faq.jpg",alt:""}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:"/images/mod_lsapi_faq_01.jpg",alt:""}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"2"}},[e("li",[this._v("_Using native PHP from _")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:"/images/mod_lsapi_faq_02.jpg",alt:""}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:"/images/mod_lsapi_faq_03.jpg",alt:""}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:"/images/mod_lsapi_faq_04.jpg",alt:""}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("extension=/opt/alt/php56/usr/lib64/php/modules/mysqli.so\nextension=/opt/alt/php56/usr/lib64/php/modules/pdo_mysql.so\nextension=/opt/alt/php56/usr/lib64/php/modules/pdo.so\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("# ls /opt/alt/php56/usr/lib64/php/modules/\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("Note.")]),this._v(" Some extensions may conflict with each other, be careful when enabling them through the file.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"3"}},[e("li",[e("em",[this._v("Using switch_mod_lsapi --build-native-lsphp as native.")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("# /usr/local/bin/php -v\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("PHP 5.6.30 (cli) (built: Jun 13 2017 06:23:21) \nCopyright (c) 1997-2016 The PHP Group\nZend Engine v2.6.0, Copyright (c) 1998-2016 Zend Technologies\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:"/images/mod_lsapi_faq_05.jpg",alt:""}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("# cp /opt/alt/php56/usr/bin/lsphp /usr/local/bin/\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"installing-mod-lsapi-for-plesk"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#installing-mod-lsapi-for-plesk","aria-hidden":"true"}},[this._v("#")]),this._v(" Installing mod_lsapi for Plesk")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("yum install liblsapi liblsapi-devel\nyum install mod_lsapi\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:"/images/screenshot_20161029_132208_zoom84.png",alt:""}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",[e("li",[this._v("Chose")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:"/images/php_settings_zoom94.png",alt:""}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"2"}},[e("li",[this._v("Now you can manage your PHP (versions and modules) from .")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:"/images/php_version_zoom94.png",alt:""}}),this._v("\nClick and to apply your choice "),e("em",[this._v(".")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"3"}},[e("li",[e("p",[this._v("Summary.")])]),this._v(" "),e("li",[e("p",[this._v("For correct work of - chose for domain .")])]),this._v(" "),e("li",[e("p",[this._v("If any other LSPHP version is chosen in Plesk, then will not be available anymore.")])]),this._v(" "),e("li",[e("p",[this._v("For enabling native PHP from the vendor, select on the management page.")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"criu-support"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#criu-support","aria-hidden":"true"}},[this._v("#")]),this._v(" CRIU Support")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("em",[this._v("[")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("table",[s("thead",[s("tr",[s("th"),t._v(" "),s("th"),t._v(" "),s("th"),t._v(" "),s("th")])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("strong",[t._v("Option name")])]),t._v(" "),s("td",[s("strong",[t._v("Description")])]),t._v(" "),s("td",[s("strong",[t._v("Values")])]),t._v(" "),s("td",[s("strong",[t._v("Default")])])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("Enable/disable CRIU for lsphp freezing.")]),t._v(" "),s("td"),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("Set path to socket for communication with criu service.")]),t._v(" "),s("td",[t._v("[path to socket]")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("Enable/disable flag for notification about lsphp started. This method avoid cycles of waiting for lsphp start.")]),t._v(" "),s("td"),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("Number of request when lsphp should be freezed.")]),t._v(" "),s("td",[t._v("[number] 0 - no freezing")]),t._v(" "),s("td",[t._v("0")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("Method of requests counting. - use shared memory. - use signals from child processes to parent.")]),t._v(" "),s("td"),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("Path to folder where imgs of freezed PHP will be stored.")]),t._v(" "),s("td",[t._v("[path]")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("Enable/Disable CRIU related debug logging.")]),t._v(" "),s("td"),t._v(" "),s("td")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[s("em",[t._v("lsapi_criu On")]),t._v(" "),s("em",[t._v("lsapi_criu_socket_path /var/run/criu/criu_service.socket")]),t._v(" "),s("em",[t._v("lsapi_backend_semtimedwait On")]),t._v(" "),s("em",[t._v("lsapi_backend_initial_start 15")]),t._v(" "),s("em",[t._v("lsapi_criu_use_shm Off")]),t._v(" "),s("em",[t._v("lsapi_criu_debug Off")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("Important!")]),this._v(" If php.ini or configuration file from php.d is changed, the images must be deleted manually.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("# cat httpd.service\n[Unit]\nDescription=Apache web server managed by cPanel EasyApache\nConditionPathExists=!/etc/httpddisable\nConditionPathExists=!/etc/apachedisable\nConditionPathExists=!/etc/httpdisable\n\n[Service]\nType=forking\nExecStart=/usr/local/cpanel/scripts/restartsrv_httpd --no-verbose\nPIDFile=/var/run/apache2/httpd.pid\nPrivateTmp=false\n \n[Install]\nWantedBy=multi-user.target\n \n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('mkdir /etc/systemd/system/httpd.service.d\necho "[Service]" >  /etc/systemd/system/httpd.service.d/nopt.conf\necho "PrivateTmp=false" >> /etc/systemd/system/httpd.service.d/nopt.conf\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("# systemctl daemon-reload\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",[e("li",[this._v("Enable service and start it:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("systemctl enable criu\nsystemctl start criu\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"2"}},[e("li",[this._v("Edit lsapi.conf file, turn CRIU On and set some defaults:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("lsapi_criu On\nlsapi_criu_socket_path /var/run/criu/criu_service.socket\nlsapi_backend_semtimedwait On\nlsapi_backend_initial_start 15\nlsapi_criu_use_shm Off\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"3"}},[e("li",[this._v("Restart apache:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("service httpd restart\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",[e("li",[this._v("An option added to the Apache configuration for cleaning all the images earlier saved by CRIU.")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("table",[s("thead",[s("tr",[s("th"),t._v(" "),s("th"),t._v(" "),s("th"),t._v(" "),s("th")])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("strong",[t._v("Option name")])]),t._v(" "),s("td",[s("strong",[t._v("Description")])]),t._v(" "),s("td",[s("strong",[t._v("Value")])]),t._v(" "),s("td",[s("strong",[t._v("Default")])])]),t._v(" "),s("tr",[s("td",[s("code")]),t._v(" "),s("td",[t._v("This option allows cleaning all CRIU images on Apache restart.")]),t._v(" "),s("td"),t._v(" "),s("td")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("It can be enabled by writing in "),e("em",[this._v("lsapi.conf")]),this._v(" (Virtual Host and .htaccess do not allow to use this option).")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"2"}},[e("li",[e("p",[this._v("If you need to clean CRIU images for one user you can simply add file to the user's directory with CRIU images (default ). On the next restart of lsphp the images will be cleaned.")])]),this._v(" "),e("li",[e("p",[this._v("Global reset flag for cleaning all earlier saved images by CRIU.")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("mkdir /usr/share/criu\nmkdir /usr/share/criu/mod_lsapi\nchown nobody:nobody /usr/share/criu/mod_lsapi\ntouch /usr/share/criu/mod_lsapi/lsphp.criu.reset\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"4"}},[e("li",[this._v("Аdded possibility to clean CRIU images from user space.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("em",[this._v("Example:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("cd; touch mod_lsapi_reset_me_criu.test.com\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("where "),e("em",[this._v("vhost.conf")]),this._v(" contains:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("em",[this._v("ServerName criu.test.com")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"5"}},[e("li",[this._v("There is (default ) option in mod_lsapi that creates only one lsphp process for a user, regardless of the number of his virtual hosts. We don't recommend to use this option with CRIU, but if you use it, make sure that your virtual hosts (under the same user) have the same environment configurations. If they are not the same, this may cause undesirable lsphp process operation.")])])}],!1,null,null,null);i.options.__file="README.md";e.default=i.exports}}]);